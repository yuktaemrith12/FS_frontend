<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MDX After Class</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Vue 2 -->
  <script src="https://unpkg.com/vue@2.7.14/dist/vue.min.js"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <!-- Styles -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div id="app">
    <!-- ===== Global Header / Nav ===== -->
    <nav class="site-nav">
      <div class="nav-left">
        <span class="brand"><i class="fa-solid fa-graduation-cap"></i> MDX After Class</span>
      </div>
      <ul class="nav-right">
        <li><a href="#" :class="{active:view==='home'}" @click.prevent="go('home')">Home</a></li>
        <li><a href="#" :class="{active:view==='lessons'}" @click.prevent="go('lessons')">Book Now</a></li>
        <li>
          <!-- Cart pill (toggle) -->
          <button
            class="cart-pill"
            :disabled="view !== 'cart' && cart.length === 0"
            @click="view === 'cart' ? go('lessons') : go('cart')"
            :aria-label="view === 'cart' ? 'Back to lessons' : 'Open cart'"
            :title="view === 'cart' ? 'Back to lessons' : 'Open cart'"
          >
            <i class="fa-solid fa-cart-shopping"></i>
            <span class="count" v-if="cart.length">{{ cart.length }}</span>
            <span class="label">{{ view === 'cart' ? 'Back' : 'Cart' }}</span>
          </button>

        </li>
      </ul>
    </nav>

    <!-- ===== HOME VIEW (hero + tutors) ===== -->
<!-- ===== HOME VIEW (hero) ===== -->
    <main v-if="view==='home'" class="home">
        <section class="hero">
            <!-- LEFT: image -->
            <div class="hero-art">
            <img src="assets/start.png" alt="Student illustration">
            </div>

            <!-- RIGHT: title + description -->
            <div class="hero-copy">
            <h1>Learn Beyond Classrooms</h1>
            <p>
                Discover fun and engaging after-school activities designed to build
                new skills, spark creativity, and help students grow to the next level.
            </p>
            <div class="hero-actions">
                <a href="#tutors" class="btn hollow">Our Tutors</a>
                <button class="btn primary" @click="go('lessons')">Book Now</button>
            </div>
            </div>
        </section>

      <!-- Tutors -->
        <section id="tutors" class="tutors">
        <h2>Our Tutors</h2>
        <div class="tutor-grid">

            <article class="tutor-card">
            <div class="avatar"><img src="assets/prof4.jpg" alt=""></div>
            <h3>Dr. Sarah Johnson</h3>
            <p>PhD in Mathematics, 12+ years teaching experience. Specialist in algebra, calculus, and preparing students for competitive exams.</p>
            </article>

            <article class="tutor-card">
            <div class="avatar"><img src="assets/prof2.jpg" alt=""></div>
            <h3>Mrs. Danila Smith</h3>
            <p>MSc in Computer Science, former software engineer. 8+ years teaching coding, web development, and robotics to high school and university students.</p>
            </article>

            <article class="tutor-card">
            <div class="avatar"><img src="assets/prof3.jpg" alt=""></div>
            <h3>Ms. Aisha Patel</h3>
            <p>BA in English Literature, 10 years tutoring experience. Focused on creative writing, public speaking, and helping learners build confidence in communication.</p>
            </article>

            <article class="tutor-card">
            <div class="avatar"><img src="assets/prof1.jpg" alt=""></div>
            <h3>Mr. Kevin Lee</h3>
            <p>MFA in Music Education, professional pianist. 15 years experience in teaching piano, music theory, and leading school orchestras.</p>
            </article>

        </div>

        <div class="tutors-cta">
            <button class="btn primary lg" @click="go('lessons')">Book Now</button>
        </div>
        </section>

    </main>

    <!-- ===== LESSONS VIEW ===== -->
    <main v-if="view==='lessons'" class="container">
      <!-- Toolbar (sort + search) -->
      <header class="toolbar">
        <div class="muted small">Sort by</div>
        <select v-model="sortBy" aria-label="Sort attribute">
          <option value="topic">Subject</option>
          <option value="location">Location</option>
          <option value="price">Price</option>
          <option value="space">Spaces</option>
        </select>

        <div class="muted small">Order</div>
        <select v-model="sortDir" aria-label="Sort order">
          <option value="asc">Ascending</option>
          <option value="desc">Descending</option>
        </select>

        <input class="search-input" v-model.trim="searchTerm" placeholder="Search subject, location, price, spaces…" />
      </header>

      <p v-if="loading" class="muted">Loading lessons…</p>
      <p v-else-if="sortedLessons.length === 0" class="muted">No results.</p>

      <!-- Product-style grid -->
      <section class="product-grid">
        <article class="product-card" v-for="l in sortedLessons" :key="l._id">
          <div class="pc-media">
            <img :src="l.img || 'assets/placeholder.jpg'" :alt="cap(l.topic)" loading="lazy" />
            <button class="pc-fav" type="button" aria-label="Save">
              <i class="fa-regular fa-heart"></i>
            </button>
          </div>

          <div class="pc-body">
            <h3 class="pc-title">{{ cap(l.topic) }}</h3>

            <!-- Required metadata for coursework -->
            <ul class="pc-meta">
              <li><strong>Location:</strong> {{ l.location }}</li>
              <li><strong>Price:</strong> Rs {{ l.price }}</li>
              <li><strong>Spaces:</strong> {{ l.space }}</li>
            </ul>

            <div class="pc-stars" :aria-label="`Rating ${l.rating}/5`">
              <i v-for="n in 5" :key="n"
                :class="[n<=l.rating ? 'fa-solid' : 'fa-regular','fa-star']"></i>
            </div>

            <button class="btn primary pc-cta"
                    :disabled="l.space<=0"
                    :class="{disabled:l.space<=0}"
                    @click="addToCart(l)">
              {{ l.space>0 ? 'Book Now' : 'Sold Out' }}
            </button>
          </div>
        </article>
      </section>
    </main>


    <!-- ===== CART / CHECKOUT VIEW ===== -->
    <main v-if="view==='cart'" class="container">
      <h2 class="page-title">Your Lesson Cart</h2>

      <section v-if="cart.length" class="cart-grid">
        <!-- LEFT: Table -->
        <article class="card cart-table-wrap">
          <table class="cart-table" aria-label="Selected lessons">
            <thead>
              <tr>
                <th>Lesson</th>
                <th>Location</th>
                <th class="right">Price (Rs)</th>
                <th class="center">Remove</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(l, idx) in cart" :key="idx">
                <td class="cap">{{ l.topic }}</td>
                <td>{{ l.location }}</td>
                <td class="right">{{ l.price }}</td>
                <td class="center">
                  <button class="icon-btn danger" @click="removeFromCart(idx)" aria-label="Remove lesson">
                    <i class="fa-solid fa-xmark"></i>
                  </button>
                </td>
              </tr>
            </tbody>
            <tfoot>
              <tr class="grand">
                <td colspan="2" class="right">Total</td>
                <td class="right"><strong>Rs {{ cartTotal }}</strong></td>
                <td></td>
              </tr>
            </tfoot>
          </table>

        </article>

        <!-- RIGHT: Modern Checkout -->
        <aside class="card pay-panel">
          <h3>Checkout</h3>

          <div class="pay-method">
            <label class="radio"><input type="radio" name="pm" checked/> <span>Pay on site</span></label>
            <label class="radio"><input type="radio" name="pm" disabled/> <span class="muted">Card (demo)</span></label>
          </div>

          <div class="form compact">
            <label>
              Full Name
              <input v-model="order.name" placeholder="Letters only" />
              <small :class="validName ? 'ok' : 'err'">{{ validName ? '✔ Looks good' : 'Letters only (A–Z, spaces)' }}</small>
            </label>
            <label>
              Phone
              <input v-model="order.phone" placeholder="Numbers only" />
              <small :class="validPhone ? 'ok' : 'err'">{{ validPhone ? '✔ Looks good' : 'Digits only (0–9)' }}</small>
            </label>
          </div>

          <button class="btn primary checkout-btn"
                  :disabled="!canCheckout"
                  @click="openConfirm">
            Check Out
          </button>
          <p v-if="message" class="message">{{ message }}</p>
        </aside>
      </section>

      <p v-else class="muted">Your cart is empty.</p>

      <!-- Confirmation Modal -->
      <div class="modal-mask" v-if="showConfirm" @click.self="showConfirm=false">
        <div class="modal">
          <h3>Order confirmation</h3>
          <p class="muted">You’re about to submit your booking for <strong>{{ cart.length }}</strong> lesson(s), total <strong>Rs {{ cartTotal }}</strong>.</p>
          <div class="modal-actions">
            <button class="btn" @click="showConfirm=false">Cancel</button>
            <button class="btn primary" @click="finalizeCheckout">Confirm & Go Home</button>
          </div>
        </div>
      </div>
    </main>

  </div>

    <script>
      new Vue({
        el: "#app",
        data: {
          // Set to "" during design to use seed quickly; set to your Render URL later
          API_BASE: "",
          view: "home",           // 'home' | 'lessons' | 'cart'

          lessons: [],
          loading: true,

          // sorting + search (Lessons view)
          sortBy: "topic",
          sortDir: "asc",
          searchTerm: "",

          // cart + checkout
          cart: [],
          order: { name: "", phone: "" },
          message: "",
          // modal
          showConfirm: false
        },

        computed: {
          validName()  { return /^[A-Za-z ]+$/.test(this.order.name || ""); },
          validPhone() { return /^[0-9]+$/.test(this.order.phone || ""); },
          canCheckout(){ return this.cart.length>0 && this.validName && this.validPhone; },

          // running total for cart table + checkout
          cartTotal() {
            return this.cart.reduce((sum, l) => sum + Number(l.price || 0), 0);
          },

          filteredLessons() {
            const q = (this.searchTerm || "").toLowerCase();
            if (!q) return this.lessons;
            return this.lessons.filter(l =>
              String(l.topic).toLowerCase().includes(q) ||
              String(l.location).toLowerCase().includes(q) ||
              String(l.price).toLowerCase().includes(q) ||
              String(l.space).toLowerCase().includes(q)
            );
          },
          sortedLessons() {
            const arr = this.filteredLessons.slice();
            const key = this.sortBy;
            const dir = this.sortDir === "asc" ? 1 : -1;
            return arr.sort((a,b) => {
              let va=a[key], vb=b[key];
              if (typeof va==="string") va=va.toLowerCase();
              if (typeof vb==="string") vb=vb.toLowerCase();
              if (va<vb) return -1*dir;
              if (va>vb) return 1*dir;
              return 0;
            });
          }
        },

        methods: {
          go(view) { 
            this.view = view; 
            window.scrollTo(0, 0); 
          },

          cap(s) { 
            return String(s || '').charAt(0).toUpperCase() + String(s || '').slice(1); 
          },

          loadLessons(){
            const seed = [
              { _id:"1", topic:"math",      location:"Hendon",        price:500, space:5, rating:5, img:"assets/1.png" },
              { _id:"2", topic:"biology",   location:"Colindale",     price:900,  space:5, rating:4, img:"assets/2.png" },
              { _id:"3", topic:"english",   location:"Brent Cross",   price:800,  space:5, rating:5, img:"assets/3.png" },
              { _id:"4", topic:"music",     location:"Golders Green", price:600, space:5, rating:4.5, img:"assets/4.png" },
              { _id:"5", topic:"art",       location:"Hendon",        price:750,  space:5, rating:5, img:"assets/5.png" },
              { _id:"6", topic:"coding",    location:"Wood Green",    price:450, space:5, rating:3, img:"assets/6.png" },
              { _id:"7", topic:"dance",     location:"Hendon",        price:960,  space:5, rating:4, img:"assets/7.png" },
              { _id:"8", topic:"history",   location:"Colindale",     price:665,  space:5, rating:4, img:"assets/8.png" },
              { _id:"9", topic:"economics", location:"Brent Cross",   price:500, space:5, rating:4, img:"assets/9.png" },
              { _id:"10",topic:"chemistry", location:"Golders Green", price:750, space:5, rating:5, img:"assets/10.png" }
            ];

            if (!this.API_BASE) {
              this.lessons = seed; this.loading = false; return;
            }
            fetch(this.API_BASE + "/lessons")
              .then(r => { if(!r.ok) throw new Error(); return r.json(); })
              .then(json => this.lessons = json)
              .catch(() => this.lessons = seed)
              .finally(() => this.loading = false);
          },

          addToCart(lesson){
            if(lesson.space>0){ this.cart.push(lesson); lesson.space -= 1; }
          },
          removeFromCart(idx){
            const lesson = this.cart.splice(idx,1)[0];
            const original = this.lessons.find(l => l._id===lesson._id);
            if (original) original.space += 1;
          },

          // open the confirmation modal if form is valid
          openConfirm(){
            if(this.canCheckout) this.showConfirm = true;
          },

          // confirm -> submit order -> modal closes -> back home (submitOrder already routes home)
          finalizeCheckout(){
            this.submitOrder();
            this.showConfirm = false;
          },

          submitOrder(){
            const payload = {
              name: this.order.name.trim(),
              phone: this.order.phone.trim(),
              lessonIDs: this.cart.map(l=>l._id),
              space: this.cart.length
            };
            fetch(this.API_BASE + "/orders", {
              method:"POST", headers:{ "Content-Type":"application/json" },
              body: JSON.stringify(payload)
            })
            .finally(()=>{
              this.cart = []; this.order = {name:"", phone:""}; this.go('home');
            });
          }
        },

        mounted(){ this.loadLessons(); }
      });
    </script>

</body>
</html>
